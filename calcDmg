#!/usr/bin/bash
[ -z "$1" ] && printf 'at = atk\nam = artsMod\nn = np damage\np = powerMod\nse = special attack\n\ne.g., bm50 at20 n50' && echo && exit 0
. $HOME/.local/bin/scripts4fgo/GLOBAL
. $HOME/.local/bin/scripts4fgo/GLOBAL_CHECK
[ ! -d "$OUT_DIR" ] && mkdir "$OUT_DIR"
OUT_DIR=$RAM_DIR/s4go
rmNotNum(){ echo "$i" | tr -d -c 0-9'\n';}
for i in "$@"; do
	case "$i" in
		at*)
			rmNotNum "$i" >> "$OUT_DIR"/at &;;
		am*)
			rmNotNum "$i" >> "$OUT_DIR"/am &;;
		bm*)
			rmNotNum "$i" >> "$OUT_DIR"/bm &;;
		qm*)
			rmNotNum "$i" >> "$OUT_DIR"/qm &;;
		n*)
			rmNotNum "$i" >> "$OUT_DIR"/n &;;
		p*)
			rmNotNum "$i" >> "$OUT_DIR"/p &;;
		se*)
			awk -v i="$i" 'BEGIN {print substr(i,3,2)/10}' > "$RAM_DIR"/se &;;
		str*)
			[[ $i =~ 1 ]] && echo "$i.33333333333" > "$OUT_DIR"/str &;;
	esac
done
ifThenSum(){ { [ -s "$OUT_DIR"/"$1" ] && sumFile "$OUT_DIR"/"$1" >> "$OUT_DIR"/result;} &}
sumFile(){ awk '{sum += $1} END {print sum}' "$1";}
wait
ifThenSum at &
ifThenSum am &
ifThenSum bm &
ifThenSum qm &
ifThenSum n &
ifThenSum p &
wait
awk 'BEGIN {prod = 1} {if ($1) prod *= $1} END {print prod}' "$OUT_DIR"/result
